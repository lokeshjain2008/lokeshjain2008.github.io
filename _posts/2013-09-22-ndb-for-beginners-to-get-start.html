---
layout: post
title: NDB for beginner's to get a start.
date: '2013-09-22T05:57:00.000-07:00'
author: lokesh jain
tags:
- GAE
- ndb
- google app engine
modified_time: '2013-09-22T06:17:29.209-07:00'
blogger_id: tag:blogger.com,1999:blog-3986102045809195254.post-2690150490154786399
blogger_orig_url: http://phptricksand.blogspot.com/2013/09/ndb-for-beginners-to-get-start.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">NDB is the newest way to store data in GAE(Google AppEngine). I had to struggle with it to get a good start here is what i learned from my experiments.

  <br /><div>Note: this tutorial is for GAE using Python.</div><div><br /></div><div>Here tables are represented by class and class name represents table(kind).</div><div>These class has to inherit form ndb.Model.</div><div><br /></div><div>for this.</div><div>here is the code</div><div><br /></div><div>create file with the two kinds</div><div><br /></div><div><blockquote class="tr_bq">from google.appengine.ext import ndb<br />class Religion(ndb.Model):<br />&nbsp; &nbsp; religion = ndb.StringProperty(required=True)<br />&nbsp; &nbsp; no_of_people = ndb.IntegerProperty()<br />&nbsp; &nbsp; name = ndb.StringProperty()<br />&nbsp; <br />class Student(ndb.Model):<br />&nbsp; &nbsp; name = ndb.StringProperty()<br />&nbsp; &nbsp; age = ndb.StringProperty()<br />&nbsp; &nbsp; religion = ndb.StringProperty()</blockquote>Save this file named as models.py .<br /><br />In the above example, we have to declare entity property(like column in mysql) and data type or property<br />e.g. ndb.StringProrperty(required=True)<br /><br />There are more type, follow the <a href="https://developers.google.com/appengine/docs/python/ndb/properties#types" target="_blank">link</a> for this.<br />Like i have passed the option that this property can't be empty &nbsp;using required = True.<br /><br />There are more for this follow the <a href="https://developers.google.com/appengine/docs/python/ndb/properties#options" target="_blank">link</a>. These called property options.<br /><br />Note: These property can be accessed by shorter name.<br />e.g<br /><blockquote class="tr_bq">first_name_student = ndb.StringProperty('f_name')</blockquote>Now, the property can be accessed using f_name too.<br /><br />Note: The link has advanced part you can skip for now <a href="https://developers.google.com/appengine/docs/python/ndb/properties#structured" target="_blank">link</a>.<br /><br />Put data into the table(ndb.Model).<br />case 1<br /><blockquote class="tr_bq">&nbsp; &nbsp; &nbsp; &nbsp; student_key = ndb.Key(Religion,"brotherhood")<br />&nbsp; &nbsp; &nbsp; &nbsp; student = Student(parent = student_key)<br />&nbsp; &nbsp; &nbsp; &nbsp; student.age = age<br />&nbsp; &nbsp; &nbsp; &nbsp; student.id = "Global"<br />&nbsp; &nbsp; &nbsp; &nbsp; student.religion = "brotherhood"<br />&nbsp; &nbsp; &nbsp; &nbsp; student.name = "human"<br />&nbsp; &nbsp; &nbsp; &nbsp; student.put() #this is put data into the entity table.</blockquote>Here i have used parent key that links it the entity in the kind Religion with id="brotherhood".<br /><br />There is no need to put parent key you can do this directly<br />case 2<br /><blockquote class="tr_bq">&nbsp; &nbsp; &nbsp; &nbsp;student = Student(parent = student_key)<br />&nbsp; &nbsp; &nbsp; &nbsp; student.age = age<br />&nbsp; &nbsp; &nbsp; &nbsp; student.id = "Global"<br />&nbsp; &nbsp; &nbsp; &nbsp; student.religion = "brotherhood"<br />&nbsp; &nbsp; &nbsp; &nbsp; student.name = "human"<br />&nbsp; &nbsp; &nbsp; &nbsp; student.put() #this is put data into the entity table.</blockquote>Get entity:<br />you can get the entity in<br />case 2:<br />As<br /><blockquote class="tr_bq">entity = Student.get_by_id(id_value)</blockquote>not id_value can be get as <span style="color: yellow;">&nbsp;<span style="background-color: #999999;">key = student.put(); id_value = key.id()&nbsp;</span></span># this gives the id.<br /><br />for the case 1:<br /><blockquote class="tr_bq">entity_value = Student.get_by_id(id_value, parent=ndb.Key(models.Religion,"brotherhood")</blockquote>If have used&nbsp;<span style="background-color: #e06666; color: #999999;"> </span><span style="background-color: #e06666;">parent key</span> then we have to supply the parent key to get the entity.<br /><br />Alternate:<br /><blockquote class="tr_bq">key = student.put()<br />id = key.id()<br />parent_key = key.parent()</blockquote>Get the parent entity.<br /><blockquote class="tr_bq">&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write("=======####-----------&lt;br/&gt;")<br />&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write(key.parent().id())<br />&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write("&lt;br/&gt;")<br />&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write(key.parent().urlsafe())<br />&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write("&lt;br/&gt;")<br />&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write(key.parent())<br />&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write("&lt;br/&gt;")<br />&nbsp; &nbsp; &nbsp; &nbsp; self.response.out.write(key.parent().get())<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</blockquote>For more on the url_safe. follow the <a href="http://stackoverflow.com/questions/18938301/get-entity-key-in-ndb" target="_blank">link</a>.<br /><br />For Google cheat sheet.follow the <a href="https://docs.google.com/document/d/1AefylbadN456_Z7BZOpZEXDq8cR8LYu7QgI7bt5V0Iw/edit?pli=1" target="_blank">link</a><br /><br /><span id="docs-internal-guid-1ff3425d-454a-16da-bb07-deeb14e2a9cc"><br id="docs-internal-guid-6df388ba-454a-6ecd-97c8-72a866a83701" /><span style="font-family: Arial; font-size: 19px; font-weight: bold; vertical-align: baseline;"></span><span style="font-family: Arial; font-size: 15px; vertical-align: baseline; white-space: pre-wrap;"></span></span><br /><div dir="ltr"><table style="border-collapse: collapse; border: none;"><colgroup><col width="315"></col><col width="309"></col></colgroup><tbody><tr style="height: 0px;"><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 15px; font-weight: bold; vertical-align: baseline;">google.appengine.ext.db</span><span style="font-size: 16px; vertical-align: baseline;"></span></div></td><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 15px; font-weight: bold; vertical-align: baseline;">ndb.model</span><span style="font-size: 16px; vertical-align: baseline;"></span></div></td></tr></tbody></table></div><div dir="ltr"><table style="border-collapse: collapse; border: none;"><colgroup><col width="294"></col><col width="330"></col></colgroup><tbody><tr style="height: 0px;"><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">q = MyModel.all()</span></div><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">q.ancestor(ancestor_key)</span></div></td><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">q =</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;MyModel.query(ancestor=ancestor_key)</span></div></td></tr><tr style="height: 0px;"><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">q = MyModel.all(keys_only=True)</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">r = q.fetch(N)</span></div></td><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">r = MyModel.query() \</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;.fetch(N, keys_only=True)</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"># Alternatively:</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">q = MyModel.query(</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default_options=QueryOptions(</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;keys_only=True))</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="background-color: transparent; color: black; font-family: 'Courier New'; font-size: 13px; font-style: normal; font-variant: normal; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">r = q.fetch(N)</span></div></td></tr></tbody></table></div><br /><blockquote class="tr_bq"></blockquote>For the cursor and pagination use the following . here form the same cheat sheet.<br /><br /><h3 dir="ltr" id="docs-internal-guid-507d8e63-459a-6cbd-a412-9abd03e739bf" style="line-height: 1.15; margin-bottom: 4pt; margin-top: 14pt;"><span style="font-family: Arial; vertical-align: baseline;">Cursors</span></h3><div dir="ltr"><table style="border-collapse: collapse; border: none; width: 624px;"><colgroup><col width="*"></col><col width="*"></col></colgroup><tbody><tr style="height: 0px;"><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">q = MyModel.all()</span></div><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">a = q.fetch(20)</span></div><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">cur = q.cursor()</span></div></td><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">q = MyModel.query()</span></div><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">a, cur, more = q.fetch_page(20)</span></div><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;"># (1)</span></div></td></tr><tr style="height: 0px;"><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">q.with_cursor(cur)</span></div><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">b = q.fetch(20)</span></div></td><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">b, cur, more = \</span></div><div dir="ltr" style="line-height: 1; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;"> &nbsp;q.fetch_page(20, start_cursor=cur)</span></div></td></tr><tr style="height: 0px;"><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">q.with_cursor(end_cursor=cur)</span></div><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">b = q.fetch(20)</span><span style="font-family: Arial; font-size: 15px; vertical-align: baseline;"></span></div></td><td style="border: 1px solid #000000; padding: 7px 7px 7px 7px; vertical-align: top;"><div dir="ltr" style="line-height: 1.15; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: 'Courier New'; font-size: 13px; vertical-align: baseline;">q.fetch(20, end_cursor=cur)</span></div><br /><span style="font-family: Arial; font-size: 15px; vertical-align: baseline;"></span></td></tr></tbody></table></div><br /><br />&nbsp;a= holds the data here and<br />cur = cursor for the next data<br />more = true if more data is there.<br /><br />Note: for the next data and cursor : use<br /><span style="background-color: yellow;">start_cursor = cur</span><br />for the previous data and cursors<br /><span style="background-color: yellow;">end_cursor = cur</span></div><div><br /><pre class="prettyprint"><span style="background-color: #9fc5e8;"><span class="pln">list_of_keys </span><span class="pun">=</span><span class="pln"> ndb</span><span class="pun">.</span><span class="pln">put_multi</span><span class="pun">(</span><span class="pln">list_of_entities</span><span class="pun">)</span><span class="pln"><br />list_of_entities </span><span class="pun">=</span><span class="pln"> ndb</span><span class="pun">.</span><span class="pln">get_multi</span><span class="pun">(</span><span class="pln">list_of_keys</span><span class="pun">)</span><span class="pln"><br />ndb</span><span class="pun">.</span><span class="pln">delete_multi</span><span class="pun">(</span><span class="pln">list_of_keys</span><span class="pun">)</span></span></pre><pre class="prettyprint"><span class="pun"><br /></span></pre></div><div>For, now this is ok! next we will look into the id's <a href="https://developers.google.com/appengine/docs/python/ndb/entities#numeric_keys" target="_blank">some link</a>.<br /><pre class="lang-py prettyprint prettyprinted" style="background-color: #eeeeee; border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 14px; line-height: 18px; margin-bottom: 10px; max-height: 600px; overflow: auto; padding: 5px; vertical-align: baseline; width: auto;"><code style="border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; margin: 0px; padding: 0px; vertical-align: baseline;"><span class="kwd" style="background-color: transparent; border: 0px; color: darkblue; margin: 0px; padding: 0px; vertical-align: baseline;">from</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"> google</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">.</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">appengine</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">.</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">api </span><span class="kwd" style="background-color: transparent; border: 0px; color: darkblue; margin: 0px; padding: 0px; vertical-align: baseline;">import</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"> namespace_manager<br /><br />namespace_manager</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">.</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">set_namespace</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">(</span><span class="str" style="background-color: transparent; border: 0px; color: maroon; margin: 0px; padding: 0px; vertical-align: baseline;">'thenamespace'</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">)</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"><br /></span><span class="typ" style="background-color: transparent; border: 0px; color: #2b91af; margin: 0px; padding: 0px; vertical-align: baseline;">MyModel</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">.</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">get_by_id</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">(</span><span class="pln" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">some_id_name</span><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">)</span></code></pre><pre class="lang-py prettyprint prettyprinted" style="background-color: #eeeeee; border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 14px; line-height: 18px; margin-bottom: 10px; max-height: 600px; overflow: auto; padding: 5px; vertical-align: baseline; width: auto;"><code style="border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; margin: 0px; padding: 0px; vertical-align: baseline;"><span class="pun" style="background-color: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"><a href="http://stackoverflow.com/questions/10321244/cant-use-ndb-get-by-id-to-get-entity-in-namespace">http://stackoverflow.com/questions/10321244/cant-use-ndb-get-by-id-to-get-entity-in-namespace</a></span></code></pre></div></div>
