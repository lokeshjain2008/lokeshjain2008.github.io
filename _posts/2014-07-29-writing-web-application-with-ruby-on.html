---
layout: post
title: Writing a web application with Ruby on Rails | 12 Devs
date: '2014-07-28T12:14:00.001-07:00'
author: lokesh jain
tags: 
modified_time: '2014-10-26T23:08:56.768-07:00'
blogger_id: tag:blogger.com,1999:blog-3986102045809195254.post-7347974656604913999
blogger_orig_url: http://phptricksand.blogspot.com/2014/07/writing-web-application-with-ruby-on.html
---

Unless you have lived under a rock for the past 5 years or so, you should have already heard of&nbsp;<a href="http://rubyonrails.org/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Ruby on Rails</a>. In this article, we’ll write a very simple web application to show its power and speed of development.



<div dir="ltr" style="text-align: left;" trbidi="on"><br /><br /><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Unless you have lived under a rock for the past 5 years or so, you should have already heard of&nbsp;<a href="http://rubyonrails.org/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Ruby on Rails</a>. In this article, we’ll write a very simple web application to show its power and speed of development.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">We’ll cover the following topics:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">install Ruby</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">install the rails gem</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">how to start a new rails project</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">directory structure of a rails project</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">how to manage data with a database</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">use already available components to handle common tasks</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">add CRUD resources</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">improve the app flawlessy</li></ul><h2 style="box-sizing: border-box; color: #10335b; font-family: quatro-slab, sans-serif; font-size: 1.75rem; margin: 0px; padding: 0.5rem 0px 0px; text-shadow: rgb(255, 255, 255) 0px 0px 1rem;">Quick setup</h2><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The following section offers a very quick overview of the tools you need to get started with Ruby on Rails development. If you already have a working rails environment, excluding the default ruby installation that some operating systems have, then feel free to skip the steps.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Install Ruby</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">If you run Linux or MacOSX on your computer, you may already have Ruby installed by default, however these kind of installations are out of date (eg: ruby 1.8.x) and&nbsp;<em style="box-sizing: border-box;">gems</em>&nbsp;are difficult to manage. The best way is to install it manually or just use some tool that helps to manage custom Ruby installations, even multiple versions (eg: 1.9.x and 2.0.0 releases).</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Instead of repeating what others have already said, here are some useful guides:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">MacOSX:&nbsp;<a href="http://createdbypete.com/articles/ruby-on-rails-development-with-mac-os-x-mountain-lion/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Ruby on Rails development with Mac OS X Mountain Lion</a>. Follow the steps until you reach&nbsp;<em style="box-sizing: border-box;">Install SQLite3</em>&nbsp;section, we’ll see here how to install rails.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">Linux:&nbsp;<a href="http://gorails.com/setup/ubuntu" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Setup Ruby On Rails on Ubuntu 13.04</a>. Same as above, follow the steps until you reach&nbsp;<em style="box-sizing: border-box;">Configuring Git</em>.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">Windows:&nbsp;<a href="http://www.ruby-forum.com/topic/4413168" style="box-sizing: border-box; color: #e05042; text-decoration: none;">SQLite3 Ruby 2.0 on Windows</a>&nbsp;and&nbsp;<a href="http://kylecordes.com/2008/git-windows-go" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Getting Started with Git and GitHub on Windows</a>. I haven’t too much experience on windows, so keep the finger crossed and/or ask on the same forum thread. The Ruby community is very kind&nbsp;<img alt=":-)" class="wp-smiley" src="http://12devs.co.uk/wp-includes/images/smilies/icon_smile.gif" style="border: 0px; box-sizing: border-box;" /></li></ul><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Now, you should have all the requirements to get started.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Install Bundler gem</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;"><a href="http://gembundler.com/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Bundler</a>&nbsp;is a&nbsp;<a href="http://guides.rubygems.org/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Ruby gem</a>&nbsp;that helps you to manage development dependencies in a project. We’ll see how it works later, for now, just install it:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">gem install bundler<br /></code></pre><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Install Rails v4.0.0.rc2 gem</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">We’re going to use the upcoming new version of rails. At the time of writing (mid June 2013), it’s the&nbsp;<em style="box-sizing: border-box;">2nd Release Candidate</em>&nbsp;but, according to its author,&nbsp;<a href="https://twitter.com/dhh/status/344819888566702081" style="box-sizing: border-box; color: #e05042; text-decoration: none;">it should be stable enough</a>.</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">gem install rails -v4.0.0.rc2<br /></code></pre><h2 style="box-sizing: border-box; color: #10335b; font-family: quatro-slab, sans-serif; font-size: 1.75rem; margin: 0px; padding: 0.5rem 0px 0px; text-shadow: rgb(255, 255, 255) 0px 0px 1rem;">A Simple Web Application to Manage and Share Bookmarks</h2><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Someone says that&nbsp;<em style="box-sizing: border-box;">doing it is the best way to learn</em>, so here’s a&nbsp;<em style="box-sizing: border-box;">less common</em>&nbsp;tutorial app: a simple platform to manage or share bookmarks. It’s nothing fancy, but it’s enough to apply some basic concepts. Moreover, aren’t you bored of&nbsp;<em style="box-sizing: border-box;">todo lists</em>&nbsp;and&nbsp;<em style="box-sizing: border-box;">blog engines</em>&nbsp;over and over?&nbsp;<img alt=":-)" class="wp-smiley" src="http://12devs.co.uk/wp-includes/images/smilies/icon_smile.gif" style="border: 0px; box-sizing: border-box;" /></div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Create the rails app</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">When you install rails, it comes with a bunch of other libraries and/or command line tools. The main one is&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">rails</code>. For now, we’ll use it to generate the initial skeleton:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">rails new bookmarks -T -d sqlite3 -B<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">I’ve also passed some arguments to the command:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">bookmarks</code>: is the name of our project.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">-T</code>: skip&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">Test::Unit</code>&nbsp;files. It’s not fundamental for our purpose (but they are in the everyday Ruby&nbsp;<em style="box-sizing: border-box;">and</em>&nbsp;Rails development), so I skipped them because&nbsp;<em style="box-sizing: border-box;">testing</em>&nbsp;is an argument apart and I don’t want to overcomplicate this article.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">-d sqlite3</code>: we want to use&nbsp;<a href="http://www.sqlite.org/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">SQLite</a>&nbsp;database. It fits perfectly for our purposes. Please note that, Rails has support for a wide variety of databases, even NoSQL ones. It’s also common to have different database engines based on the environment (eg: SQLite for development, MySQL or PostgreSQL for production, etc…) without code changes.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">-B</code>: don’t run&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">bundle install</code>, we’ll do it manually later.</li></ul><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Once you run the command, you should see a long list of lines that explain what is happening:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos % rails new bookmarks -T -d sqlite3 -B<br />    create  <br />    create  README.rdoc<br />    create  Rakefile<br />    create  config.ru<br />    create  .gitignore<br />    create  Gemfile<br />    create  app<br />    [...]<br />andrea@mbair ~/Works/12dos % cd bookmarks<br />andrea@mbair ~/Works/12dos/bookmarks %<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">A new directory called&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">bookmarks</code>&nbsp;(or whatever project name you passed) has been created, along with a set of files and directories inside it. Enter this directory, we’ll see the important contents during the article.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">A first look at Bundler and Gemfile</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">We mentioned Bundler as a tool to manage development dependencies in a Ruby app. It works by reading a file called&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">Gemfile</code>&nbsp;that should be present in the root directory of the app. You need this to make sure all the required gems are installed, even rails itself. Here’s a brief look at the Gemfile generated by the&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">rails new</code>&nbsp;command:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">source 'https://rubygems.org'<br /><br /># Our rails version<br />gem 'rails', '4.0.0.rc2'<br /><br /># Use sqlite3 as the database for Active Record<br />gem 'sqlite3'<br /><br /># Use SCSS for stylesheets<br />gem 'sass-rails', '~&gt; 4.0.0.rc2'<br /><br /># Use Uglifier as compressor for JavaScript assets<br />gem 'uglifier', '&gt;= 1.3.0'<br /><br /># Use CoffeeScript for .js.coffee assets and views<br />gem 'coffee-rails', '~&gt; 4.0.0<br /><br /># Uncomment this if you haven't a nodejs and coffeescript installed<br /># gem 'therubyracer', platforms: :ruby<br /><br />[...]<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">As you can see, this is the default list of gems you need to start working on a Rails project. Of course, you’ll change it very often to add, remove or upgrade gems.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Now you can finally run&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">bundle install</code>&nbsp;(the command we skipped by specifying&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">-B</code>):</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % bundle install<br />Fetching gem metadata from https://rubygems.org/..........<br />Fetching gem metadata from https://rubygems.org/..<br />Resolving dependencies...<br />Using rake (10.0.4)<br />Installing i18n (0.6.4)<br />[...]<br />Your bundle is complete!<br />Use `bundle show [gemname]` to see where a bundled gem is installed.<br />andrea@mbair ~/Works/12dos/bookmarks %<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">If you use&nbsp;<em style="box-sizing: border-box;">git</em>, this is a good moment to initialize the repo and proceed with the initial commit.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Run the development server</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Even if you haven’t yet wrote any line of code, you can already use the Rails development server. Run the following command:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rails server<br />=&gt; Booting WEBrick<br />=&gt; Rails 4.0.0.rc2 application starting in development on http://0.0.0.0:3000<br />=&gt; Run `rails server -h` for more startup options<br />=&gt; Ctrl-C to shutdown server<br />[2013-06-14 16:10:48] INFO  WEBrick 1.3.1<br />[2013-06-14 16:10:48] INFO  ruby 1.9.3 (2012-04-20) [x86_64-darwin12.2.0]<br />[2013-06-14 16:10:48] INFO  WEBrick::HTTPServer#start: pid=1174 port=3000<br />[...]<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">then point your browser to&nbsp;<a href="http://localhost:3000/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000</a>&nbsp;and you’ll get a standard welcome page. This time we’ve used&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">rails server</code>, another useful command offered by Rails, moreover, it works only when you run it inside a Rails project folder. We’ll see other useful commands later.</div><h2 style="box-sizing: border-box; color: #10335b; font-family: quatro-slab, sans-serif; font-size: 1.75rem; margin: 0px; padding: 0.5rem 0px 0px; text-shadow: rgb(255, 255, 255) 0px 0px 1rem;">A quick introduction to MVC patterns and Rails</h2><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Rails is usually defined as an&nbsp;<em style="box-sizing: border-box;">MVC framework</em>. Basically, it means that the app behaviour is defined in this way:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><strong style="box-sizing: border-box;">Model:</strong>&nbsp;manages data between the rest of the application and the database. You can define how a single entity behaves, this includes data validation, before/after save hooks, etc…</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><strong style="box-sizing: border-box;">Controller:</strong>&nbsp;this is the&nbsp;<em style="box-sizing: border-box;">glue</em>&nbsp;between the data managed by the Models and the rendered Views. Http requests that come to your app, are&nbsp;<em style="box-sizing: border-box;">routed</em>&nbsp;to a controller which usually will interact with one or more models and finally renders the ouput along with an Http response.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><strong style="box-sizing: border-box;">View:</strong>&nbsp;the final output for a request. It’s usually a piece of HTML, but it might also be JSON or XML. We’ll see this later.</li></ul><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">This is, of course, an over-simplification, but it should be enough to get a&nbsp;<em style="box-sizing: border-box;">vague idea</em>&nbsp;of how it works. I’ll dive into some details later.</div><h2 style="box-sizing: border-box; color: #10335b; font-family: quatro-slab, sans-serif; font-size: 1.75rem; margin: 0px; padding: 0.5rem 0px 0px; text-shadow: rgb(255, 255, 255) 0px 0px 1rem;">Add a Bookmark resource</h2><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The goal of our app is to manage bookmarks, right? So we’ll need to create our&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">Bookmark</code>resource:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rails generate scaffold bookmark title:string url:string<br />    invoke  active_record<br />    create    db/migrate/20130614142337_create_bookmarks.rb<br />    create    app/models/bookmark.rb<br />    invoke  resource_route<br />     route    resources :bookmarks<br />    invoke  scaffold_controller<br />    create    app/controllers/bookmarks_controller.rb<br />    [...]<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">This time, we’ve used&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">rails generate</code>, one of the most useful commands. In this case, we’ve generated a&nbsp;<em style="box-sizing: border-box;">scaffold</em>&nbsp;that creates all the necessary files and code to automatically get a full&nbsp;<em style="box-sizing: border-box;">MVC</em>&nbsp;stack that manages a&nbsp;<em style="box-sizing: border-box;">Bookmark</em>. In the next few paragraphs, we’ll see in detail what the above command did.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Database migration</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">We’ve specified that a&nbsp;<em style="box-sizing: border-box;">Bookmark</em>&nbsp;record is made of a&nbsp;<em style="box-sizing: border-box;">title</em>&nbsp;and a&nbsp;<em style="box-sizing: border-box;">url</em>&nbsp;fields, both of type&nbsp;<em style="box-sizing: border-box;">string</em>(255 chars by default). So, the rails scaffold generator has automatically created a&nbsp;<em style="box-sizing: border-box;">migration</em>script to update your database schema:<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">db/migrate/db/migrate/20130614142337_create_bookmarks.rb</code></div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">class CreateBookmarks &lt; ActiveRecord::Migration<br />  def change<br />    create_table :bookmarks do |t|<br />      t.string :title<br />      t.string :url<br /><br />      t.timestamps<br />    end<br />  end<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Even if it’s almost easy to read, this code basically means:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">create a&nbsp;<em style="box-sizing: border-box;">bookmarks</em>&nbsp;table on database (note the pluralized form)</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">it has the fields&nbsp;<em style="box-sizing: border-box;">title</em>&nbsp;and&nbsp;<em style="box-sizing: border-box;">url</em>&nbsp;of type string</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">also add timestmps by default (this is automatically translated to&nbsp;<em style="box-sizing: border-box;">created_at</em>&nbsp;and<em style="box-sizing: border-box;">updated_at</em>&nbsp;datetime fields)</li></ul><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">However, your database still doesn’t know about these changes to the schema, you need to run the migration task:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rake db:migrate<br />==  CreateBookmarks: migrating ================================================<br />-- create_table(:bookmarks)<br />   -&gt; 0.0011s<br />==  CreateBookmarks: migrated (0.0012s) =======================================<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;"><a href="http://rake.rubyforge.org/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Rake</a>&nbsp;is another common and useful tool in the Ruby world. It acts like a&nbsp;<em style="box-sizing: border-box;">Makefile</em>&nbsp;in a Ruby fashion. Rails comes with several&nbsp;<em style="box-sizing: border-box;">rake</em>&nbsp;tasks ready to use (you can also create custom ones, if needed):</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rake -T<br />rake about                  # List versions of all Rails frameworks and the environment<br />rake assets:clean           # Remove old compiled assets<br />rake assets:clobber         # Remove compiled assets<br />rake assets:environment     # Load asset compile environment<br />[...]<br /></code></pre><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">The Bookmark model</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The model representing a&nbsp;<em style="box-sizing: border-box;">bookmark</em>&nbsp;was created in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/models/bookmark.rb</code>, at the moment it’s almost empty in terms of code, but it already knows how to behave with the database. To demonstrate this, we’ll use another Rails command to open a&nbsp;<em style="box-sizing: border-box;">console</em>:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rails console<br />Loading development environment (Rails 4.0.0.rc2)<br />&gt;<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Now, we have a shell to manually issue commands to our rails app. Let’s see if it knows something about our&nbsp;<em style="box-sizing: border-box;">Bookmark</em>:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">&gt; Bookmark<br />=&gt; Bookmark(id: integer, title: string, url: string, user_id: integer, created_at: datetime, updated_at: datetime)<br /><br />&gt; Bookmark.count<br />   (0.3ms)  SELECT COUNT(*) FROM "bookmarks"<br />=&gt; 0<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">It knows about the&nbsp;<em style="box-sizing: border-box;">bookmarks</em>&nbsp;table, its fields and how to query the database. Ok, create one<em style="box-sizing: border-box;">Bookmark</em>:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">&gt; Bookmark.create(title: "Hello Bookmarks app!", url: "http://localhost:3000")<br />   (0.1ms)  begin transaction<br />  SQL (7.7ms)  INSERT INTO "bookmarks" ("created_at", "title", "updated_at", "url") VALUES (?, ?, ?, ?)  [["created_at", Fri, 14 Jun 2013 15:16:17 UTC +00:00], ["title", "Hello Bookmarks app!"], ["updated_at", Fri, 14 Jun 2013 15:16:17 UTC +00:00], ["url", "http://localhost:3000"]]<br />   (0.8ms)  commit transaction<br />=&gt; #&lt;Bookmark id: 1, title: "Hello Bookmarks app!", url: "http://localhost:3000", user_id: nil, created_at: "2013-06-14 15:16:17", updated_at: "2013-06-14 15:16:17<br /><br />&gt; Bookmark.count<br />   (0.3ms)  SELECT COUNT(*) FROM "bookmarks"<br />=&gt; 1<br /></code></pre><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">The BookmarksController and its views</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">We said that the&nbsp;<em style="box-sizing: border-box;">scaffold generator</em>&nbsp;has created all the parts of the MVC stack, now is the time for the controller in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/controllers/bookmarks_controller.rb</code>. You’ll see a<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">BookmarksController</code>&nbsp;class and a bunch of methods (called&nbsp;<em style="box-sizing: border-box;">actions</em>). Each action corresponds to an HTTP PATH (eg:&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">/bookmarks</code>) and an HTTP verb (GET, POST, PUT, DELETE).</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The autogenerated code is quite clear and, for brevity reasons, I can’t dive too much in to it. The interesting parts are:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">nowhere in the code is specified how to render views. There’s a reason for that: HTML views are based on the controller’s actions names. For example,<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">BookmarksController#show</code>&nbsp;will render a template placed in<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">app/views/bookmarks/show.html.erb</code>. Of course, only the actions that respond to&nbsp;<em style="box-sizing: border-box;">HTTP GET</em>&nbsp;have a template, the rest are usually redirects. Check the contents of<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">app/views/bookmarks/</code>&nbsp;yourself to get an idea.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">it looks like there’s some automagical&nbsp;<em style="box-sizing: border-box;">JSON</em>&nbsp;support. That’s true, rails supports&nbsp;<em style="box-sizing: border-box;">HTML</em>and&nbsp;<em style="box-sizing: border-box;">JSON</em>&nbsp;request by default, I’ll show you this later.</li></ul><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Routes</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The final component for the&nbsp;<em style="box-sizing: border-box;">MVC</em>&nbsp;stack is about routing the&nbsp;<em style="box-sizing: border-box;">HTTP</em>&nbsp;requests to the proper controller and action. To make this, the Rails generator has updated&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">config/routes.rb</code>file and has added the line&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">resources :bookmarks</code>&nbsp;that is a shorthand to say:&nbsp;<em style="box-sizing: border-box;">use&nbsp;<a href="http://en.wikipedia.org/wiki/Representational_State_Transfer" style="box-sizing: border-box; color: #e05042; text-decoration: none;">REST</a>routes for the the resource bookmark</em>. If you’re wondering&nbsp;<em style="box-sizing: border-box;">what</em>&nbsp;routes are available, you can use the relative&nbsp;<em style="box-sizing: border-box;">rake task</em>:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rake routes<br />       Prefix Verb   URI Pattern                   Controller#Action<br />    bookmarks GET    /bookmarks(.:format)          bookmarks#index<br />              POST   /bookmarks(.:format)          bookmarks#create<br /> new_bookmark GET    /bookmarks/new(.:format)      bookmarks#new<br />edit_bookmark GET    /bookmarks/:id/edit(.:format) bookmarks#edit<br />     bookmark GET    /bookmarks/:id(.:format)      bookmarks#show<br />              PATCH  /bookmarks/:id(.:format)      bookmarks#update<br />              PUT    /bookmarks/:id(.:format)      bookmarks#update<br />              DELETE /bookmarks/:id(.:format)      bookmarks#destroy<br /></code></pre><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Try on the server</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Now, the fun part. Restart your rails server with&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">rails server</code>&nbsp;and go to<a href="http://localhost:3000/bookmarks" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/bookmarks</a>. If you followed the above example in console, you should already see the Bookmark created earlier, otherwise, you can create a new one by clicking on<em style="box-sizing: border-box;">New bookmark</em>&nbsp;link.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Try&nbsp;<a href="http://localhost:3000/bookmarks.json" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/bookmarks.json</a>&nbsp;and see what you’ll get. You still haven’t wrote a single line of Ruby, and it already does a lot of things. Awesome, isn’t it?&nbsp;<img alt=":-)" class="wp-smiley" src="http://12devs.co.uk/wp-includes/images/smilies/icon_smile.gif" style="border: 0px; box-sizing: border-box;" /></div><h2 style="box-sizing: border-box; color: #10335b; font-family: quatro-slab, sans-serif; font-size: 1.75rem; margin: 0px; padding: 0.5rem 0px 0px; text-shadow: rgb(255, 255, 255) 0px 0px 1rem;">Adding users and authentication</h2><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Once we have the&nbsp;<em style="box-sizing: border-box;">Bookmark</em>&nbsp;resource, we need&nbsp;<em style="box-sizing: border-box;">Users</em>&nbsp;that own bookmarks and a way to authenticate them. The Ruby and Rails community is very active: whatever the task is, you’ll probably find at least one gem to do it (if you don’t, it might be a good idea to write one). Luckily, user authentication is a very common task, and there are several options. The most used is&nbsp;<a href="https://github.com/plataformatec/devise" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Devise</a>, let’s use it.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Installing Devise gem</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Open&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">Gemfile</code>&nbsp;and add this line:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">gem 'devise', '~&gt; 3.0.0.rc'<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">We also told Bundler to use a version of Devise that should be&nbsp;<em style="box-sizing: border-box;">greater_or_equal</em>&nbsp;than its<em style="box-sizing: border-box;">minor version</em>&nbsp;(eg: 3.0.1 is ok, 3.1.0 isn’t).</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Run&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">bundle install</code>&nbsp;to install the gem:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % bundle install<br />Resolving dependencies...<br />Using rake (10.0.4)<br />[...]<br />Installing devise (3.0.0.rc)<br />[...]<br />Your bundle is complete!<br />Use `bundle show [gemname]` to see where a bundled gem is installed.<br />andrea@mbair ~/Works/12dos/bookmarks % <br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">and run the Devise generator:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rails generate devise:install<br />      create  config/initializers/devise.rb<br />      create  config/locales/devise.en.yml<br />===============================================================================<br /><br />Some setup you must do manually if you haven't yet:<br /><br />  1. Ensure you have defined default url options in your environments files. Here <br />     is an example of default_url_options appropriate for a development environment <br />     in config/environments/development.rb:<br /><br />       config.action_mailer.default_url_options = { :host =&gt; 'localhost:3000' }<br /><br />     In production, :host should be set to the actual host of your application.<br /><br />  2. Ensure you have defined root_url to *something* in your config/routes.rb.<br />     For example:<br /><br />       root :to =&gt; "home#index"<br /><br />  3. Ensure you have flash messages in app/views/layouts/application.html.erb.<br />     For example:<br /><br />       &lt;p class="notice"&gt;&lt;%= notice %&gt;&lt;/p&gt;<br />       &lt;p class="alert"&gt;&lt;%= alert %&gt;&lt;/p&gt;<br /><br />  4. If you are deploying Rails 3.1+ on Heroku, you may want to set:<br /><br />       config.assets.initialize_on_precompile = false<br /><br />     On config/application.rb forcing your application to not access the DB<br />     or load models when precompiling your assets.<br /><br />  5. You can copy Devise views (for customization) to your app by running:<br /><br />       rails g devise:views<br /><br />===============================================================================<br />andrea@mbair ~/Works/12dos/bookmarks % <br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">As you can see, it has created two files under&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">config/</code>&nbsp;directory:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">config/initializers/devise.rb</code>: here you can change several Devise settings. However, we’ll use defaults because they are enough.</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">config/locales/devise.en.yml</code>: this file contains i18n translations for Devise. Please note that&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">config/locales/</code>&nbsp;is the default path to put all the locales for a Rails app.</li></ul><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Devise also told us to check five steps to complete the setup:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">add&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">config.action_mailer.default_url_options = { :host =&gt; 'localhost:3000' }</code>&nbsp;to&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">config/environments/development.rb</code></li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><div style="box-sizing: border-box; margin-bottom: 1.4rem;">define a&nbsp;<em style="box-sizing: border-box;">root_url</em>&nbsp;in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">config/routes.rb</code>. Fow now, we can achieve this by pointing<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">BookmarksController#index</code>&nbsp;to the root of the site:</div><div style="box-sizing: border-box; margin-bottom: 1.4rem;">Bookmarks::Application.routes.draw do # [...] root ‘bookmarks#index’</div><div style="box-sizing: border-box; margin-bottom: 1.4rem;"># [...] end</div></li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><div style="box-sizing: border-box; margin-bottom: 1.4rem;">add the two pieces of html in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/views/layouts/application.html.erb</code>. This file is the main layout your Rails app.</div></li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;"><div style="box-sizing: border-box; margin-bottom: 1.4rem;">skip the fourth step because we’re running a Rails v4.0.x app, not a 3.1.x one)</div></li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">generate the Devise default views with&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">rails generate devise:views</code>. They contain a basic scaffold to get Devise to work (eg: login/signup forms, etc…). Please note that Devise has several features concerning user authentication and registration, but we’re going to use only a small set of them, so don’t panic if you see a lot of generated views.</li></ul><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Generate a User model</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Setup for Devise is done, but we still haven’t a&nbsp;<em style="box-sizing: border-box;">User</em>&nbsp;model, we need to create one:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">andrea@mbair ~/Works/12dos/bookmarks % rails generate devise User<br />      invoke  active_record<br />      create    db/migrate/20130617132545_devise_create_users.rb<br />      create    app/models/user.rb<br />      insert    app/models/user.rb<br />       route  devise_for :users<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">If you remember the scaffold generator we used to generate a&nbsp;<em style="box-sizing: border-box;">Bookmark</em>, this one is very similar even if just focused on the model, plus the route that tells Devise to handle<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">/users/*</code>&nbsp;paths. In fact, it created a migration for users and the&nbsp;<em style="box-sizing: border-box;">User</em>&nbsp;class. Edit the migration to look like this (remove or comment the rest):</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">class DeviseCreateUsers &lt; ActiveRecord::Migration<br />  def change<br />    create_table(:users) do |t|<br />      ## Database authenticatable<br />      t.string :email,              :null =&gt; false, :default =&gt; ""<br />      t.string :encrypted_password, :null =&gt; false, :default =&gt; ""<br /><br />      ## Rememberable<br />      t.datetime :remember_created_at<br /><br />      t.timestamps<br />    end<br /><br />    add_index :users, :email,                :unique =&gt; true<br />  end<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Also the model needs to reflect the changes made to the migration:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">class User &lt; ActiveRecord::Base<br />  devise :database_authenticatable, :registerable,<br />         :rememberable, :validatable<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The last step, is to run the migration with&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">rake db:migrate</code></div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">In this way, we have a simple authentication system that lets a user to register, login and logout. Try to run&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">rake routes</code>&nbsp;and you’ll see the new routes for these actions, all referred to&nbsp;<em style="box-sizing: border-box;">users</em>. You can also play in the Rails console to create some users.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Users have many Bookmarks</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Now that we have&nbsp;<em style="box-sizing: border-box;">User</em>&nbsp;and&nbsp;<em style="box-sizing: border-box;">Bookmark</em>, we need to&nbsp;<em style="box-sizing: border-box;">associate</em>&nbsp;them. In this case, it’s a&nbsp;<em style="box-sizing: border-box;">one to many</em>&nbsp;relationship. As a shared convention, foreign keys name are made of the model name suffixed by&nbsp;<em style="box-sizing: border-box;">_id</em>. Of course, we’ll not change the already created migrations, instead, we’re going to create a new one:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">rails generate migration AddUserIdToBookmark user_id:integer<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Choosing an appropriate, arbitrary name is not mandatory, but it’s a&nbsp;<em style="box-sizing: border-box;">best practice</em>&nbsp;that you should follow. Our generated migration will add a&nbsp;<em style="box-sizing: border-box;">user_id</em>&nbsp;integer column to the&nbsp;<em style="box-sizing: border-box;">bookmarks</em>table. Also, feel free to run the migration now.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">At the moment, none of our two rails models knows about each other, we’ve only added a field on the database, but it’s meaningless without some additional instruction:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">add&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">has_many :bookmarks</code>&nbsp;to&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">app/models/user.rb</code></li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">add&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">belongs_to :user</code>&nbsp;to&nbsp;<code style="box-sizing: border-box; font-family: monospace, serif; font-size: 1em;">app/models/user.rb</code></li></ul><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">With these changes, a&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">User</code>&nbsp;instance will automatically have a&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">bookmarks</code>&nbsp;method (and many others), referred to all&nbsp;<em style="box-sizing: border-box;">Bookmark</em>&nbsp;records with that specific&nbsp;<em style="box-sizing: border-box;">user id</em>.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Require authentication to manage your bookmarks</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Looking at the models, it looks like the&nbsp;<em style="box-sizing: border-box;">data part</em>&nbsp;is complete and working. However, the<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">BookmarksController</code>&nbsp;created by the scaffold command doesn’t apply any authentication check, it needs some fixing.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">First of all, check user authentication before executing whatever action:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">class BookmarksController &lt; ApplicationController<br />  # other before_actions<br />  before_action :authenticate_user!<br /><br />  # [...] actions<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">This means that, from now on, each request that arrives to the&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">BookmarksController</code>&nbsp;will first check if a user is authenticated (<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">authenticate_user!</code>&nbsp;is a method provided by Devise), otherwise it will be redirected to the login page.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Then, access only bookmarks owned by the authenticated user. To do this, replace<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">Bookmark</code>&nbsp;occurrencies with&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">current_user.bookmarks</code>. As you may wonder,<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">current_user</code>&nbsp;is an object provided by Devise that represents the authenticated user, while&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">.bookmarks</code>&nbsp;is the method provided by the model association between&nbsp;<em style="box-sizing: border-box;">User</em>&nbsp;and<em style="box-sizing: border-box;">Bookmark</em>&nbsp;models.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Try on the server</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">If you haven’t played with the web interface yet, now is a good time to do it. Here are some hints:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">go to&nbsp;<a href="http://localhost:3000/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000</a>, it should redirect to&nbsp;<a href="http://localhost:3000/users/sign_in" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/users/sign_in</a>, the login page;</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">if you haven’t registered any user, then go to&nbsp;<a href="http://localhost:3000/users/sign_up" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/users/sign_up</a>&nbsp;and register a new one;</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">retry to go to&nbsp;<a href="http://localhost:3000/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/</a>&nbsp;again, it will work as well as going to<a href="http://localhost:3000/bookmarks" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/bookmarks</a>&nbsp;because they’re the same action;</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">create some bookmarks from&nbsp;<a href="http://localhost:3000/bookmarks/new" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/bookmarks/new</a>.</li></ul><h2 style="box-sizing: border-box; color: #10335b; font-family: quatro-slab, sans-serif; font-size: 1.75rem; margin: 0px; padding: 0.5rem 0px 0px; text-shadow: rgb(255, 255, 255) 0px 0px 1rem;">Handling wrong inputs</h2><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">At the moment, we have several areas where a wrong user input might damage you application:</div><ul style="box-sizing: border-box; color: #333333; font-family: sans-serif; font-size: 20px; line-height: 28px;"><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">providing incomplete or malformed data when creating a new Bookmark</li><li style="box-sizing: border-box; font-family: ff-meta-web-pro, sans-serif; margin: 0px 0px 1.4rem;">requesting a bookmark id that doesn’t exist as a record on the database, for example by visiting&nbsp;<a href="http://localhost:3000/bookmarks/111" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000/bookmarks/111</a>, will cause an error in your app, very ugly to see.</li></ul><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Let’s see how to solve these issues.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Model validations</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">If you tried to use a password shorter than 8 chars or a bad formatted email during user registrations, you’d note that Devise has spotted those errors by not saving the record and rendering the user registration form again. In fact, Devise provided some default validations for users, but our app needs validations on the&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">Bookmark</code>&nbsp;model too. Change<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/models/bookmark.rb</code>&nbsp;to look like this:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">class Bookmark &lt; ActiveRecord::Base<br />  belongs_to :user<br /><br />  #&nbsp;ensure that a user_id is present<br />  validates :user_id, presence: true<br /><br />  # ensure that title is present and at least 10 chars long<br />  validates :title, length: { minimum: 10 }, presence: true<br /><br />  # ensure the url is present, and respects the URL format for http/https<br />  validates :url, format: {with: Regexp.new(URI::regexp(%w(http https)))}, presence: true<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">These validations are self-explanatory, so I’ll not dive into them. Just keep in mind that there are many others or, in this case, you can create custom ones.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">When a resource is not found…</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The second problem we addressed is about passing a wrong/non-existent identifier for a given resource. You can handle it in many ways, perhaps the simplest (and laziest) one is to redirect to the index, with a&nbsp;<em style="box-sizing: border-box;">flash message</em>. To do this, we only need to change some line of code in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">BookmarksController</code>:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">class BookmarksController &lt; ApplicationController<br />  # [...] other code here<br /><br />  private<br />    # Use callbacks to share common setup or constraints between actions.<br />    def set_bookmark<br />      unless @bookmark = current_user.bookmarks.where(id: params[:id]).first<br />        flash[:alert] = 'Bookmark not found.'<br />        redirect_to root_url<br />      end<br />    end<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">set_bookmark</code>&nbsp;is a method called in a&nbsp;<em style="box-sizing: border-box;">before_action</em>&nbsp;only for actions that need a resource id (show, edit, update, destroy). The new lines will safely check for existence in the database, otherwise the user will be redirected to the root path of the site, with a short flash message.</div><h2 style="box-sizing: border-box; color: #10335b; font-family: quatro-slab, sans-serif; font-size: 1.75rem; margin: 0px; padding: 0.5rem 0px 0px; text-shadow: rgb(255, 255, 255) 0px 0px 1rem;">Improving the app one step at a time</h2><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Our app is almost complete, or at least, it lacks several little details that make a difference. We’ll try to address some of these. The goal, is to demonstrate how to improve an existing app with small steps.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Add a better root page</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">This is a simple task. All we need is a new route, controller and view. This time, we’ll use a generator dedicated to the controller:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">rails generate controller site index<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">I’ve omitted the output because at the moment you should be able to guess what it does. In short, it has created a&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">SiteController</code>&nbsp;with an action called&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">index</code>, plus the related view in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/views/site/index.html.erb</code>&nbsp;and a new route in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">config/routes.rb</code>. However, the route should be changed to reflect our goal:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">Bookmarks::Application.routes.draw <br />  # [...] other routes<br /><br />  # Comment/remove these lines<br />  # get "site/index"<br />  # root 'bookmarks#index'<br /><br />  # Use this<br />  root 'site#index'<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">If you try to load&nbsp;<a href="http://localhost:3000/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">http://localhost:3000</a>&nbsp;you’ll see the empty template of<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/views/site/index.html.erb</code>. To render content, we need to change the controller in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/controllers/site_controller.rb</code>:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">class SiteController &lt; ApplicationController<br />  def index<br />    #&nbsp;retrieve all Bookmarks ordered by descending creation timestamp<br />    @bookmarks = Bookmark.order('created_at desc')<br />  end<br />end<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">while the view in&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/views/site/index.html.erb</code>, might contain this basic markup as a starting point:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">&lt;h2&gt;Latest Bookmarks&lt;/h2&gt;<br />&lt;table style="width: 100%"&gt;<br />  &lt;thead&gt;<br />    &lt;tr&gt;<br />      &lt;th&gt;Url&lt;/th&gt;<br />    &lt;/tr&gt;<br />  &lt;/thead&gt;<br /><br />  &lt;tbody&gt;<br />  &lt;% @bookmarks.each do |bookmark| %&gt;<br />    &lt;tr&gt;<br />      &lt;td&gt;&lt;%= link_to bookmark.title, bookmark.url %&gt;&lt;/td&gt;<br />    &lt;/tr&gt;<br />  &lt;% end %&gt;<br />  &lt;/tbody&gt;<br />&lt;/table&gt;<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Again, note how the controller processes the request by retrieving some records from the database through the model&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">Bookmark</code>, then renders its view that contains the proper data to show the bookmarks.</div><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Prettier GUI</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Being a programmer, I’m not too skilled in design and layouts, but there are several CSS frameworks that help a lot. Instead of picking the famous&nbsp;<a href="http://twitter.github.io/bootstrap/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">Twitter Bootstrap</a>, I chose&nbsp;<a href="http://foundation.zurb.com/" style="box-sizing: border-box; color: #e05042; text-decoration: none;">ZURB Foundation</a>, just to be fancy. There are a lot of ways to integrate existing CSS/Javascript frameworks and libraries inside a Rails app, the simplest one, is to use a gem when possible. Luckily, there’s one for Zurb Foundation, just add it to your Gemfile:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">gem 'zurb-foundation', '~&gt; 4.2.2'<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">run&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">bundle install</code>, plus its install generator:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">rails generate foundation:install<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">this command, will ask you to overwrite your default application layout in<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/views/layouts/application.html.erb</code>, press&nbsp;<em style="box-sizing: border-box;">Y</em>&nbsp;without worries. For brevity reasons, I’ve put the contents of the file&nbsp;<a href="https://gist.github.com/apeacox/87e2c7261abeeb1ccf9d" style="box-sizing: border-box; color: #e05042; text-decoration: none;">here</a>.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Moreover, we can also remove old scaffold’s stylesheets:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">rm app/assets/stylesheets/scaffolds.css.scss<br /></code></pre><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">Prettier forms</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">Forms are still ugly and boring to write, so we’ll use&nbsp;<a href="https://github.com/plataformatec/simple_form" style="box-sizing: border-box; color: #e05042; text-decoration: none;">another useful gem</a>&nbsp;(from the same authors of&nbsp;<em style="box-sizing: border-box;">Devise</em>) to mitigate the problem. Add it to your Gemfile:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">gem 'simple_form', '~&gt; 3.0.0.rc'<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">run&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">bundle install</code>&nbsp;and the install generator (note that it already supports Foundation’s markup structure):</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">rails generate simple_form:install --foundation<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">We’ll also re-generate&nbsp;<em style="box-sizing: border-box;">Devise</em>&nbsp;views, because it supports&nbsp;<em style="box-sizing: border-box;">SimpleForm</em>:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">rails generate devise:views<br /></code></pre><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The generator will ask you if you want to overwrite existent files, press&nbsp;<em style="box-sizing: border-box;">Y</em>&nbsp;because that’s what we really want.</div><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">The last step is to fix the&nbsp;<em style="box-sizing: border-box;">Bookmarks</em>&nbsp;form, it wasn’t updated by the other generators, we’ll do it manually by overwriting its (partial) template in<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/views/bookmarks/_form.html.erb</code>&nbsp;with the following content:</div><pre style="box-sizing: border-box; color: #333333; font-family: monospace, serif; font-size: 20px; line-height: 28px; white-space: pre-wrap; word-wrap: break-word;"><code style="background-color: rgba(101, 99, 101, 0.901961); border-bottom-left-radius: 5px; border-bottom-right-radius: 5px; border-color: rgba(101, 99, 101, 0.8) rgba(101, 99, 101, 0.8) rgb(101, 99, 101); border-style: solid; border-top-left-radius: 5px; border-top-right-radius: 5px; border-width: 0.1rem 0.1rem 0.2rem; box-sizing: border-box; color: #e4e3e4; display: block; font-family: courier, monospace; font-size: 1em; margin: 0px 0px 1rem; padding: 1rem; word-wrap: break-word;">&lt;%= simple_form_for(@bookmark) do |f| %&gt;<br />  &lt;%= f.error_notification %&gt;<br /><br />  &lt;div class="form-inputs"&gt;<br />    &lt;%= f.input :title %&gt;<br />    &lt;%= f.input :url %&gt;<br />  &lt;/div&gt;<br /><br />  &lt;div class="form-actions"&gt;<br />    &lt;%= f.button :submit %&gt;<br />  &lt;/div&gt;<br />&lt;% end %&gt;<br /></code></pre><h3 style="box-sizing: border-box; color: #333333; font-family: sans-serif; margin: 0px;">A welcome page</h3><div style="box-sizing: border-box; color: #333333; font-family: ff-meta-web-pro, sans-serif; font-size: 20px; line-height: 28px; margin-bottom: 1.4rem;">It would be nice and&nbsp;<em style="box-sizing: border-box;">professional</em>&nbsp;to show a welcome page for non-registered users. To keep things simple, I’ll use the same&nbsp;<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">SiteController#index</code>&nbsp;used for the root page. Modify<code style="box-sizing: border-box; font-family: courier, monospace; font-size: 1em;">app/views/site/index.html.erb</code>&nbsp;to look like&nbsp;<a href="https://gist.github.com/apeacox/98eeca9a0979c5802eb3" style="box-sizing: border-box; color: #e05042; text-decoration: none;">this</a>.</div><div><br /></div><br /><br /><br /><br /><br /><br /></div>